meta:
  Type: Report
  ID: SiteRiskScore
  Name: Site Risk Score
  Description: |
    A report that visualizes site risk score. Site risk score is calculated by assigning weights to
    flags by metric.
  Output: html
spec:
  Reporting_Results:
    _all:
      required: true
    Numerator:
      type: integer
    Denominator:
      type: integer
    Metric:
      type: numeric
    Score:
      type: numeric
    Flag:
      type: integer
  #Reporting_Metrics:
  #  _all:
  #    required: true
  #Reporting_Groups:
  #  _all:
  #    required: true
steps:
  - output: Reporting_Results_Site
    name: gsm.core::RunQuery
    params:
      df: Reporting_Results
      strQuery: |
        SELECT *
        FROM df
        WHERE GroupLevel = 'Site'
  - output: dfRiskScore
    name: gsm.kri::CalculateRiskScore
    params:
      dfResults: Reporting_Results_Site
  - output: dfRiskScoreTransposed
    name: gsm.kri::TransposeRiskScore
    params:
      dfRiskScore: dfRiskScore
  - output: lRiskScoreTable
    name: gsm.kri::Visualize_RiskScore
    params:
      dfRiskScoreTransposed: dfRiskScoreTransposed
  - output: lRiskScoreTableWidget
    name: htmlwidgets::saveWidget
    params:
      widget: lRiskScoreTable
      file: SiteRiskScore.html
      selfcontained: TRUE
      title: name

